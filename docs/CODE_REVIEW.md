# ğŸ” ä»£ç å®¡æŸ¥è§„èŒƒ (Code Review Guidelines)

> **æ–‡æ¡£ç›®çš„**: å®šä¹‰Jilo.aié¡¹ç›®çš„ä»£ç å®¡æŸ¥æ ‡å‡†ã€æµç¨‹å’Œæœ€ä½³å®è·µ  
> **åˆ›å»ºæ—¥æœŸ**: 2024-11-19  
> **ç‰ˆæœ¬**: V1.0

---

## ğŸ“‹ ç›®å½•

1. [ä¸ºä»€ä¹ˆéœ€è¦Code Review](#ä¸ºä»€ä¹ˆéœ€è¦code-review)
2. [Code Reviewæµç¨‹](#code-reviewæµç¨‹)
3. [å®¡æŸ¥æ¸…å•](#å®¡æŸ¥æ¸…å•)
4. [å¦‚ä½•ç»™å‡ºå¥½çš„åé¦ˆ](#å¦‚ä½•ç»™å‡ºå¥½çš„åé¦ˆ)
5. [å¸¸è§é—®é¢˜æ¨¡å¼](#å¸¸è§é—®é¢˜æ¨¡å¼)

---

## ä¸ºä»€ä¹ˆéœ€è¦Code Review

### ğŸ¯ æ ¸å¿ƒä»·å€¼

**1. æå‡ä»£ç è´¨é‡** - Code Reviewèƒ½å‘ç°60-80%çš„æ½œåœ¨bug

**2. çŸ¥è¯†å…±äº«** - å›¢é˜Ÿæˆå‘˜äº†è§£å½¼æ­¤çš„å·¥ä½œï¼Œä¿æŒä»£ç é£æ ¼ä¸€è‡´

**3. é›†ä½“ä»£ç æ‰€æœ‰æƒ** - ä¸æ˜¯"ä½ çš„ä»£ç "ï¼Œè€Œæ˜¯"æˆ‘ä»¬çš„ä»£ç "

**4. å‡å°‘æŠ€æœ¯å€ºåŠ¡** - åŠæ—¶å‘ç°æ¶æ„é—®é¢˜ï¼Œé¿å…ä¸´æ—¶æ–¹æ¡ˆå˜æ°¸ä¹…

---

## Code Reviewæµç¨‹

### æ­¥éª¤1: å¼€å‘è€…è‡ªæˆ‘å®¡æŸ¥

```bash
# åˆ›å»ºPRå‰è¿è¡Œæ‰€æœ‰æ£€æŸ¥
npm run lint
npm run type-check
npm run test
npm run build

# è‡ªæˆ‘å®¡æŸ¥ä»£ç 
git diff develop...HEAD
```

### æ­¥éª¤2: åˆ›å»ºPull Request

å¥½çš„PRæè¿°åŒ…å«ï¼š
- å˜æ›´ç›®çš„
- æŠ€æœ¯æ–¹æ¡ˆ
- æµ‹è¯•è®¡åˆ’
- æˆªå›¾/æ¼”ç¤º

### æ­¥éª¤3: è¿›è¡Œå®¡æŸ¥

å®¡æŸ¥è€…åº”è¯¥ï¼š
1. ç†è§£ä¸Šä¸‹æ–‡ï¼ˆ5åˆ†é’Ÿï¼‰
2. æ£€æŸ¥ä»£ç ï¼ˆ20-30åˆ†é’Ÿï¼‰
3. æä¾›åé¦ˆï¼ˆ10åˆ†é’Ÿï¼‰

---

## å®¡æŸ¥æ¸…å•

### âœ… ä»£ç è´¨é‡

```markdown
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
- [ ] å‘½åæ¸…æ™°ä¸”ä¸€è‡´
- [ ] æ²¡æœ‰è¢«æ³¨é‡Šæ‰çš„ä»£ç 
- [ ] è¾¹ç•Œæ¡ä»¶å¤„ç†æ­£ç¡®
- [ ] é”™è¯¯å¤„ç†å®Œå–„
```

### ğŸ”’ å®‰å…¨æ£€æŸ¥

```markdown
- [ ] æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ç»è¿‡éªŒè¯
- [ ] APIç«¯ç‚¹æœ‰è®¤è¯æ£€æŸ¥
- [ ] æ•æ„Ÿæ•°æ®å·²åŠ å¯†
- [ ] SQLæ³¨å…¥é˜²æŠ¤
- [ ] XSSé˜²æŠ¤
```

### âš¡ æ€§èƒ½

```markdown
- [ ] æ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½é—®é¢˜
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- [ ] æ²¡æœ‰N+1æŸ¥è¯¢é—®é¢˜
- [ ] é€‚å½“ä½¿ç”¨ç¼“å­˜
```

### ğŸ§ª æµ‹è¯•

```markdown
- [ ] æœ‰è¶³å¤Ÿçš„å•å…ƒæµ‹è¯•
- [ ] æµ‹è¯•ç”¨ä¾‹è¦†ç›–å…³é”®è·¯å¾„
- [ ] è¾¹ç•Œæ¡ä»¶æœ‰æµ‹è¯•
- [ ] æµ‹è¯•å‘½åæ¸…æ™°
```

---

## å¦‚ä½•ç»™å‡ºå¥½çš„åé¦ˆ

### ğŸš¦ åé¦ˆçº§åˆ«

ä½¿ç”¨æ ‡ç­¾æ ‡æ³¨é—®é¢˜é‡è¦æ€§ï¼š

```markdown
ğŸ”´ **Critical** - å¿…é¡»ä¿®å¤
  ä¾‹: å®‰å…¨æ¼æ´ã€ä¼šå¯¼è‡´ç”Ÿäº§ç¯å¢ƒé—®é¢˜

ğŸŸ¡ **Major** - å¼ºçƒˆå»ºè®®ä¿®å¤
  ä¾‹: ä»£ç è´¨é‡é—®é¢˜ã€è®¾è®¡ç¼ºé™·

ğŸŸ¢ **Minor** - å¯é€‰ä¿®å¤
  ä¾‹: ä»£ç é£æ ¼ã€å‘½åå»ºè®®

ğŸ’¡ **Suggestion** - è®¨è®º
  ä¾‹: æ›¿ä»£æ–¹æ¡ˆã€æœ€ä½³å®è·µåˆ†äº«
```

### âœ… å¥½çš„åé¦ˆç¤ºä¾‹

#### å…·ä½“ä¸”å»ºè®¾æ€§

```markdown
âŒ ä¸å¥½: "è¿™ä¸ªä»£ç ä¸å¥½"

âœ… å¥½çš„:
ğŸŸ¡ è¿™ä¸ªå‡½æ•°åšäº†å¤ªå¤šäº‹æƒ…ï¼ˆè·å–æ•°æ®ã€å¤„ç†ã€ä¿å­˜ï¼‰ã€‚
å»ºè®®æ‹†åˆ†æˆä¸‰ä¸ªç‹¬ç«‹çš„å‡½æ•°ä»¥æé«˜å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
```

#### æä¾›æ›¿ä»£æ–¹æ¡ˆ

```markdown
ğŸ”´ å½“å‰çš„é…é¢æ‰£é™¤æœ‰å¹¶å‘é—®é¢˜ã€‚å»ºè®®ä½¿ç”¨åŸå­æ“ä½œ:

```sql
SELECT quota FROM users WHERE id = ? FOR UPDATE;
UPDATE users SET quota = quota - 1 WHERE id = ?;
```

æˆ–ä½¿ç”¨ `atomicDeduct()` å‡½æ•°ã€‚
```

#### è®¤å¯å¥½çš„ä»£ç 

```markdown
ğŸ’š è¿™ä¸ªé”™è¯¯å¤„ç†å¾ˆå…¨é¢ï¼ç‰¹åˆ«æ˜¯è€ƒè™‘åˆ°äº†ç½‘ç»œè¶…æ—¶çš„æƒ…å†µã€‚
```

### ğŸ¯ åé¦ˆåŸåˆ™

1. **Be Kind** - å‹å–„ï¼šä»£ç èƒŒåæ˜¯äºº
2. **Be Specific** - å…·ä½“ï¼šæŒ‡å‡ºå…·ä½“ä½ç½®å’Œé—®é¢˜
3. **Be Constructive** - å»ºè®¾æ€§ï¼šæä¾›æ”¹è¿›å»ºè®®
4. **Ask Questions** - æé—®ï¼šç”¨é—®é¢˜ä»£æ›¿æŒ‡ä»¤
5. **Praise** - èµç¾ï¼šä¸è¦åå•¬èµç¾

---

## å¸¸è§é—®é¢˜æ¨¡å¼

### ğŸ› Bugæ¨¡å¼

#### 1. ç©ºå€¼æ£€æŸ¥ç¼ºå¤±

```typescript
// âŒ é—®é¢˜
function getUserName(user: User) {
  return user.profile.name; // profileå¯èƒ½ä¸ºnull
}

// âœ… ä¿®å¤
function getUserName(user: User) {
  return user.profile?.name ?? 'Anonymous';
}
```

#### 2. å¹¶å‘é—®é¢˜

```typescript
// âŒ é—®é¢˜ï¼šç«æ€æ¡ä»¶
async function deductQuota(userId: string) {
  const user = await getUser(userId);
  if (user.quota > 0) {
    await updateUser(userId, { quota: user.quota - 1 });
  }
}

// âœ… ä¿®å¤ï¼šåŸå­æ“ä½œ
async function deductQuota(userId: string) {
  return await db.rpc('atomic_deduct_quota', {
    p_user_id: userId,
    p_amount: 1
  });
}
```

### ğŸ”’ å®‰å…¨é—®é¢˜

#### SQLæ³¨å…¥

```typescript
// âŒ é—®é¢˜
const users = await db.query(
  `SELECT * FROM users WHERE email = '${email}'`
);

// âœ… ä¿®å¤ï¼šå‚æ•°åŒ–æŸ¥è¯¢
const users = await db.query(
  'SELECT * FROM users WHERE email = $1',
  [email]
);
```

#### æ•æ„Ÿä¿¡æ¯æ³„éœ²

```typescript
// âŒ é—®é¢˜
return {
  user: {
    id: user.id,
    email: user.email,
    password: user.password,  // âš ï¸
  }
};

// âœ… ä¿®å¤
return {
  user: {
    id: user.id,
    email: user.email,
    // ä¸è¿”å›æ•æ„Ÿå­—æ®µ
  }
};
```

### âš¡ æ€§èƒ½é—®é¢˜

#### N+1æŸ¥è¯¢

```typescript
// âŒ é—®é¢˜
const users = await db.select('*').from('users');
for (const user of users) {
  const posts = await db.select('*')
    .from('posts')
    .where('user_id', user.id);  // Næ¬¡æŸ¥è¯¢
}

// âœ… ä¿®å¤ï¼šæ‰¹é‡æŸ¥è¯¢
const users = await db.select('*').from('users');
const userIds = users.map(u => u.id);
const allPosts = await db.select('*')
  .from('posts')
  .whereIn('user_id', userIds);
```

---

## ğŸ“Š åº¦é‡æŒ‡æ ‡

è·Ÿè¸ªè¿™äº›æŒ‡æ ‡æ¥æ”¹è¿›Reviewæµç¨‹ï¼š

- **PRå¤§å°**: ç›®æ ‡ <500è¡Œæ”¹åŠ¨
- **Reviewæ—¶é—´**: ç›®æ ‡ 24å°æ—¶å†…é¦–æ¬¡åé¦ˆ
- **è¿­ä»£æ¬¡æ•°**: ç›®æ ‡ 1-2æ¬¡ä¿®æ”¹ååˆå¹¶
- **å‘ç°çš„bugæ•°é‡**: è¶Šå¤šè¶Šå¥½
- **é€ƒé€¸çš„bug**: è¶Šå°‘è¶Šå¥½ï¼ˆåˆå¹¶åå‘ç°çš„bugï¼‰

---

<div align="center">

**æ–‡æ¡£ç‰ˆæœ¬**: V1.0  
**æœ€åæ›´æ–°**: 2024-11-19

[è¿”å›æ–‡æ¡£ç›®å½•](../README.md) | [æŸ¥çœ‹Gitå·¥ä½œæµç¨‹](./GIT_WORKFLOW.md)

</div>
