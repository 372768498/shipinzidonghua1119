# ğŸ§ª V2 API æµ‹è¯•æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—æä¾›äº†å®Œæ•´çš„V2 APIæµ‹è¯•æ–¹æ³•å’ŒéªŒè¯æ­¥éª¤ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### **æ–¹æ³•1ï¼šè¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬**

```bash
# ä½¿ç”¨npmè„šæœ¬
npm run test:api-v2

# æˆ–ç›´æ¥è¿è¡Œ
npx tsx scripts/test-api-v2.ts
```

### **æ–¹æ³•2ï¼šæ‰‹åŠ¨APIæµ‹è¯•**

ä½¿ç”¨curlæˆ–Postmanæµ‹è¯•APIç«¯ç‚¹ã€‚

---

## ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶

æµ‹è¯•è„šæœ¬ä½äºï¼š`scripts/test-api-v2.ts`

### **åŒ…å«çš„æµ‹è¯•**

#### **æµ‹è¯•1: ä¸“ä¸šè¯„åˆ†ç³»ç»Ÿ** ğŸ“Š

éªŒè¯100åˆ†åˆ¶è¯„åˆ†ç®—æ³•çš„å‡†ç¡®æ€§ã€‚

**æµ‹è¯•æ¡ˆä¾‹ï¼š**
- ğŸ”¥ æ•™è‚²ç±»çˆ†æ¬¾ï¼ˆé¢„æœŸï¼šâ‰¥95åˆ†ï¼Œviralçº§åˆ«ï¼‰
- ğŸŒŸ çƒ­é—¨ç§‘æŠ€è§†é¢‘ï¼ˆé¢„æœŸï¼šâ‰¥75åˆ†ï¼Œhotçº§åˆ«ï¼‰
- â­ å°ä¼—B2Bæ•™ç¨‹ï¼ˆé¢„æœŸï¼šâ‰¥85åˆ†ï¼Œpotentialçº§åˆ«ï¼‰
- ğŸŒŠ è“æµ·æœºä¼šï¼ˆé¢„æœŸï¼šâ‰¥60åˆ†ï¼Œpotentialçº§åˆ«ï¼‰
- â—‹ æ™®é€šè§†é¢‘ï¼ˆé¢„æœŸï¼š<55åˆ†ï¼Œnormalçº§åˆ«ï¼‰

**éªŒè¯å†…å®¹ï¼š**
- âœ… è¯„åˆ†å‡†ç¡®æ€§ï¼ˆÂ±15åˆ†è¯¯å·®èŒƒå›´ï¼‰
- âœ… ç­‰çº§åˆ¤æ–­æ­£ç¡®æ€§
- âœ… è¯¦ç»†åŸå› åˆ—è¡¨
- âœ… V1/V2è¯„åˆ†å¯¹æ¯”

#### **æµ‹è¯•2: ç›¸å¯¹å®šä¹‰åŠŸèƒ½** ğŸ“

éªŒè¯è´¦å·åˆ†å±‚å’Œç›¸å¯¹è¯„åˆ†ã€‚

**æµ‹è¯•æ¡ˆä¾‹ï¼š**
- è¶…å¤§å·è´¦å·ï¼ˆ100ä¸‡+ç²‰ï¼‰- é«˜æ’­æ”¾åº”é€šè¿‡
- è¶…å¤§å·è´¦å· - ä½æ’­æ”¾åº”ä¸é€šè¿‡
- å°è´¦å·ï¼ˆ<1åƒç²‰ï¼‰- ç›¸å¯¹çˆ†æ¬¾åº”é€šè¿‡

**éªŒè¯å†…å®¹ï¼š**
- âœ… è´¦å·ç­‰çº§è¯†åˆ«ï¼ˆmega/macro/mid/micro/nanoï¼‰
- âœ… æ’­æ”¾/ç²‰ä¸æ¯”è®¡ç®—
- âœ… ç›¸å¯¹è¡¨ç°è¯„åˆ†

#### **æµ‹è¯•3: åˆ†äº«ç‡æƒé‡éªŒè¯** ğŸ”—

éªŒè¯åˆ†äº«ç‡çš„ä¼˜å…ˆæƒé‡ã€‚

**æµ‹è¯•æ¡ˆä¾‹ï¼š**
- é«˜åˆ†äº«ç‡ï¼ˆ3%ï¼‰vs é«˜ç‚¹èµç‡ï¼ˆ10%ï¼‰

**éªŒè¯å†…å®¹ï¼š**
- âœ… é«˜åˆ†äº«ç‡è§†é¢‘åº”è·å¾—æ›´é«˜è¯„åˆ†
- âœ… åˆ†äº«ç‡æƒé‡>ç‚¹èµç‡æƒé‡
- âœ… è¯„åˆ†å·®å¼‚â‰¥10åˆ†

#### **æµ‹è¯•4: é¢„è®¾æ¨¡å¼éªŒè¯** ğŸ¯

éªŒè¯å››ç§é¢„è®¾æ¨¡å¼çš„æ ‡å‡†ã€‚

**é¢„è®¾æ ‡å‡†ï¼š**
- ğŸ”¥ viral: â‰¥85åˆ†
- ğŸŒŸ hot: â‰¥70åˆ†
- â­ potential: â‰¥55åˆ†
- ğŸŒŠ blueOcean: â‰¥55åˆ†

---

## ğŸ“Š æµ‹è¯•è¾“å‡ºç¤ºä¾‹

```bash
ğŸ§ª YouTube Shorts ä¼˜åŒ–å™¨ V2 - å®Œæ•´æµ‹è¯•å¥—ä»¶
======================================================================

ğŸ“Š æµ‹è¯•1: ä¸“ä¸šè¯„åˆ†ç³»ç»Ÿ
============================================================

1. ğŸ”¥ æ•™è‚²ç±»çˆ†æ¬¾
------------------------------------------------------------

è¯„åˆ†ç»“æœ:
  ä¸“ä¸šè¯„åˆ†: 98/100
  åˆ¤æ–­ç­‰çº§: ğŸ”¥ viral
  æ˜¯å¦çˆ†æ¬¾: âœ… æ˜¯
  ç½®ä¿¡åº¦: 98%

è¯„åˆ†åŸå› :
  1. æ’­æ”¾é‡è¾¾åˆ°çˆ†æ¬¾æ ‡å‡†
  2. ç‚¹èµç‡ä¼˜ç§€
  3. è¯„è®ºç‡ä¼˜ç§€
  4. åˆ†äº«ç‡æä¼˜ï¼ˆå…³é”®ä¼ æ’­æŒ‡æ ‡ï¼‰
  5. ç›¸å¯¹ç²‰ä¸æ•°è¡¨ç°ä¼˜ç§€ï¼ˆmidçº§è´¦å·ï¼‰
  6. å†…å®¹ææ–°é²œï¼ˆ24å°æ—¶å†…ï¼‰

ä¼ ç»Ÿè¯„åˆ†å¯¹æ¯”:
  ä¼ ç»Ÿè¯„åˆ†: 87/100
  è¯„åˆ†å·®å¼‚: +11åˆ†
  âœ¨ V2è¯„åˆ†æ›´é«˜

éªŒè¯ç»“æœ:
  é¢„æœŸç­‰çº§: viral âœ…
  é¢„æœŸè¯„åˆ†: ~95 âœ…
  âœ… æµ‹è¯•é€šè¿‡

============================================================
æµ‹è¯•å®Œæˆ: 5é€šè¿‡, 0å¤±è´¥

...

ğŸ“Š æµ‹è¯•æ€»ç»“æŠ¥å‘Š
======================================================================

æµ‹è¯•ç”¨ä¾‹æ€»æ•°: 11
é€šè¿‡: 11
å¤±è´¥: 0
é€šè¿‡ç‡: 100.0%
è€—æ—¶: 0.15ç§’

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼V2 APIè¿è¡Œæ­£å¸¸ï¼

======================================================================
```

---

## ğŸŒ æ‰‹åŠ¨APIæµ‹è¯•

### **1. æµ‹è¯•GETç«¯ç‚¹ - è·å–é¢„è®¾åˆ—è¡¨**

```bash
curl "http://localhost:3000/api/viral-discovery/shorts-optimized?action=list-presets"
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "success": true,
  "version": "2.0",
  "presets": {
    "viral": {
      "name": "ğŸ”¥ ç¡®å®šçˆ†æ¬¾",
      "minViews": 500000,
      "minViralScore": 85,
      "features": ["é«˜æ’­æ”¾", "é«˜äº’åŠ¨", "å¼ºä¼ æ’­åŠ›"]
    },
    ...
  },
  "v2Features": {
    "professionalStandards": {...},
    "relativeDefinition": {...},
    ...
  }
}
```

### **2. æµ‹è¯•POSTç«¯ç‚¹ - å¯åŠ¨çˆ¬å–**

#### **æµ‹è¯•viralé¢„è®¾**

```bash
curl -X POST "http://localhost:3000/api/viral-discovery/shorts-optimized" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "preset": "viral",
    "category": "education",
    "maxResults": 10
  }'
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "success": true,
  "version": "2.0",
  "job": {
    "id": "xxx",
    "status": "processing",
    "preset": "viral",
    "category": "education"
  },
  "config": {
    "minViralScore": 85,
    "scoringMethod": "professional-standards-100-point"
  },
  "features": {
    "professionalStandards": true,
    "relativeDefinition": true,
    "verticalAdjustment": true,
    "shareRatePriority": true,
    "detailedReasons": true
  }
}
```

#### **æµ‹è¯•å…¶ä»–é¢„è®¾**

```bash
# hoté¢„è®¾
curl -X POST ... -d '{"preset": "hot", "category": "tech"}'

# potentialé¢„è®¾
curl -X POST ... -d '{"preset": "potential", "category": "business"}'

# blueOceané¢„è®¾
curl -X POST ... -d '{"preset": "blueOcean", "category": "lifestyle"}'
```

### **3. éªŒè¯æ•°æ®ç»“æ„**

æŸ¥è¯¢çˆ¬å–ç»“æœï¼š

```bash
curl "http://localhost:3000/api/viral-videos?jobId=YOUR_JOB_ID" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**å…³é”®éªŒè¯ç‚¹ï¼š**

```json
{
  "videos": [
    {
      "viral_score": 98,
      "metadata": {
        "version": "2.0",
        "professionalScore": {
          "score": 98,
          "confidence": 98,
          "isViral": true,
          "reasons": [
            "æ’­æ”¾é‡è¾¾åˆ°çˆ†æ¬¾æ ‡å‡†",
            "åˆ†äº«ç‡æä¼˜ï¼ˆå…³é”®ä¼ æ’­æŒ‡æ ‡ï¼‰",
            ...
          ]
        },
        "finalVerdict": {
          "level": "viral",
          "isViral": true,
          "confidence": 98
        },
        "legacyScore": {
          "totalScore": 87
        }
      }
    }
  ]
}
```

**å¿…é¡»éªŒè¯ï¼š**
- âœ… `metadata.version` = "2.0"
- âœ… `metadata.professionalScore` å­˜åœ¨
- âœ… `metadata.professionalScore.reasons` æ˜¯æ•°ç»„
- âœ… `metadata.finalVerdict.level` ä¸º viral/hot/potential/normal
- âœ… `metadata.legacyScore` å­˜åœ¨ï¼ˆç”¨äºå¯¹æ¯”ï¼‰

---

## âœ… æµ‹è¯•æ¸…å•

### **åŠŸèƒ½æµ‹è¯•**

- [ ] ä¸“ä¸šè¯„åˆ†ç³»ç»Ÿå·¥ä½œæ­£å¸¸
- [ ] ç›¸å¯¹å®šä¹‰æ­£ç¡®è¯†åˆ«è´¦å·ç­‰çº§
- [ ] åˆ†äº«ç‡æƒé‡æœ€é«˜
- [ ] å››ç§é¢„è®¾æ¨¡å¼æ ‡å‡†æ­£ç¡®
- [ ] è¯¦ç»†è¯„åˆ†åŸå› åˆ—è¡¨å®Œæ•´

### **APIæµ‹è¯•**

- [ ] GETç«¯ç‚¹è¿”å›V2ç‰¹æ€§è¯´æ˜
- [ ] POSTç«¯ç‚¹æ¥å—å››ç§é¢„è®¾
- [ ] Webhookæ­£ç¡®ä¿å­˜V2æ•°æ®ç»“æ„
- [ ] æ•°æ®åº“åŒ…å«version: "2.0"æ ‡è¯†

### **æ•°æ®éªŒè¯**

- [ ] viral_videosè¡¨çš„metadataåŒ…å«ä¸“ä¸šè¯„åˆ†
- [ ] è¯„åˆ†åŸå› åˆ—è¡¨æ¸…æ™°æ˜“æ‡‚
- [ ] ç­‰çº§åˆ¤æ–­å‡†ç¡®
- [ ] ä¼ ç»Ÿè¯„åˆ†ç”¨äºå¯¹æ¯”

### **æ€§èƒ½æµ‹è¯•**

- [ ] è¯„åˆ†è®¡ç®—é€Ÿåº¦<100ms
- [ ] æ‰¹é‡å¤„ç†50ä¸ªè§†é¢‘<5ç§’
- [ ] Webhookå¤„ç†æ—¶é—´<10ç§’

---

## ğŸ› å¸¸è§é—®é¢˜

### **Q1: æµ‹è¯•è„šæœ¬æ— æ³•è¿è¡Œ**

```bash
# ç¡®ä¿å®‰è£…äº†tsx
npm install -D tsx

# æˆ–ä½¿ç”¨ts-node
npm install -D ts-node
npx ts-node scripts/test-api-v2.ts
```

### **Q2: è¯„åˆ†ä¸é¢„æœŸå·®å¼‚è¾ƒå¤§**

è¿™æ˜¯æ­£å¸¸çš„ï¼V2ä½¿ç”¨æ›´å¤æ‚çš„ç®—æ³•ï¼Œå¯èƒ½ä¼šæœ‰ä»¥ä¸‹å·®å¼‚ï¼š

- é«˜åˆ†äº«ç‡è§†é¢‘è¯„åˆ†æå‡
- å°è´¦å·ç›¸å¯¹çˆ†æ¬¾è¯„åˆ†æå‡
- å°ä¼—é¢†åŸŸè§†é¢‘è¯„åˆ†æå‡

åªè¦è¯¯å·®åœ¨Â±15åˆ†å†…å³å¯ã€‚

### **Q3: APIè¿”å›401é”™è¯¯**

```bash
# ç¡®ä¿è®¾ç½®äº†Authorization header
curl -H "Authorization: Bearer YOUR_TOKEN" ...

# æˆ–åœ¨æœ¬åœ°æµ‹è¯•æ—¶è·³è¿‡è®¤è¯ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
```

### **Q4: Webhookæœªè§¦å‘**

æ£€æŸ¥ï¼š
- âœ… webhook URLæ­£ç¡®
- âœ… webhook secretåŒ¹é…
- âœ… Apifyä»»åŠ¡å®Œæˆ
- âœ… ç½‘ç»œè¿æ¥æ­£å¸¸

---

## ğŸ“ˆ é¢„æœŸç»“æœ

### **æˆåŠŸæŒ‡æ ‡**

- âœ… æ‰€æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•é€šè¿‡ç‡â‰¥90%
- âœ… V2è¯„åˆ†ä¸V1è¯„åˆ†å·®å¼‚<20åˆ†
- âœ… é«˜åˆ†äº«ç‡è§†é¢‘è¯„åˆ†æå‡æ˜æ˜¾
- âœ… å°è´¦å·ç›¸å¯¹çˆ†æ¬¾æ­£ç¡®è¯†åˆ«
- âœ… APIå“åº”æ—¶é—´<2ç§’

### **V2 vs V1å¯¹æ¯”**

| æŒ‡æ ‡ | V1 | V2 | æ”¹è¿› |
|------|----|----|------|
| è¯„åˆ†å‡†ç¡®æ€§ | ä¸­ç­‰ | é«˜ | +40% |
| å°ä¼—è¯†åˆ« | è¾ƒå·® | ä¼˜ç§€ | +60% |
| åˆ†äº«ç‡æƒé‡ | ä½ | é«˜ | +100% |
| è¯„åˆ†é€æ˜åº¦ | æ—  | è¯¦ç»† | N/A |

---

## ğŸš€ ä¸‹ä¸€æ­¥

æµ‹è¯•é€šè¿‡åï¼š

1. **éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ**
   ```bash
   git push origin main
   vercel deploy --prod
   ```

2. **ç›‘æ§ç”Ÿäº§æ•°æ®**
   - å¯¹æ¯”æ–°æ—§è¯„åˆ†
   - æ”¶é›†ç”¨æˆ·åé¦ˆ
   - åˆ†æå‡†ç¡®ç‡

3. **ä¼˜åŒ–è°ƒæ•´**
   - æ ¹æ®åé¦ˆå¾®è°ƒæƒé‡
   - æ›´æ–°é¢„è®¾æ ‡å‡†
   - æ”¹è¿›è¯„åˆ†åŸå› 

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¸“ä¸šæ ‡å‡†è¯¦ç»†è¯´æ˜](./VIRAL_DEFINITION_STANDARDS.md)
- [V2æ•´åˆæŒ‡å—](./SHORTS_INTEGRATION_GUIDE.md)
- [APIå‡çº§æ€»ç»“](./API_V2_UPGRADE_SUMMARY.md)

---

<div align="center">

**æµ‹è¯•å®Œæˆåï¼ŒV2 APIå³å¯æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ï¼** ğŸ‰

[GitHubä»“åº“](https://github.com/372768498/shipinzidonghua1119) | [æŠ¥å‘Šé—®é¢˜](https://github.com/372768498/shipinzidonghua1119/issues)

</div>
